<?php
 namespace Mgt\Varnish\Model\Observer; use Magento\Framework\Event\ObserverInterface; class ProductSaveAfterObserver implements ObserverInterface { protected $config; protected $productUrlRewriteGenerator; protected $catalogProductTypeConfigurable; protected $productFactory; protected $varnishConfig; protected $urlQueue; protected static $isQueued = false; public function __construct(\Magento\PageCache\Model\Config $config, \Magento\CatalogUrlRewrite\Model\ProductUrlRewriteGenerator $productUrlRewriteGenerator, \Magento\ConfigurableProduct\Model\ResourceModel\Product\Type\Configurable $catalogProductTypeConfigurable, \Magento\Catalog\Model\ProductFactory $productFactory, \Mgt\Varnish\Model\UrlQueue $urlQueue, \Mgt\Varnish\Model\Cache\Config $varnishConfig) { goto e89ae; Ebcd9: $this->catalogProductTypeConfigurable = $catalogProductTypeConfigurable; goto b2584; e89ae: $this->config = $config; goto ee872; ee872: $this->productUrlRewriteGenerator = $productUrlRewriteGenerator; goto Ebcd9; b2584: $this->productFactory = $productFactory; goto df286; df286: $this->urlQueue = $urlQueue; goto D04bb; D04bb: $this->varnishConfig = $varnishConfig; goto B8d6e; B8d6e: } public function execute(\Magento\Framework\Event\Observer $observer) { goto e9fa5; Cc2cf: foreach ($productUrls as $url) { $urls[] = ["\x73\x74\157\x72\x65\137\151\x64" => $url->getStoreId(), "\x70\141\x74\150" => $url->getRequestPath(), "\x70\162\151\x6f\162\151\164\x79" => \Mgt\Varnish\Model\UrlQueue::PRIORITY_HIGH]; Cd32f: } goto Ceaf2; A7ccb: foreach ($parentProductIds as $parentProductId) { goto b2509; b23bb: c809c: goto eb339; eb339: df942: goto Ec036; b2509: $product = $this->productFactory->create(); goto ded0a; ded0a: $product->load($parentProductId); goto c9557; f8515: foreach ($productUrls as $url) { $urls[] = ["\163\x74\x6f\162\145\137\x69\144" => $url->getStoreId(), "\x70\141\x74\x68" => $url->getRequestPath(), "\160\x72\x69\x6f\x72\151\164\171" => \Mgt\Varnish\Model\UrlQueue::PRIORITY_HIGH]; Fce34: } goto b23bb; c9557: $productUrls = $this->productUrlRewriteGenerator->generate($product); goto f8515; Ec036: } goto A8102; dd69c: $urls = []; goto B704d; e9fa5: $product = $observer->getEvent()->getProduct(); goto B4ac4; B4ac4: $isCacheWarmerEnabled = $this->varnishConfig->isCacheWarmerEnabled(); goto ceeb9; A8102: b0261: goto C3b0e; dee37: if (!count($parentProductIds)) { goto B7a38; } goto A7ccb; ceeb9: if (!(true === $isCacheWarmerEnabled && isset($product) && $product instanceof \Magento\Catalog\Model\Product)) { goto c22af; } goto c722a; B704d: if (false === empty($productUrls)) { goto d8c8a; } goto d95f1; d95f1: $productId = $product->getId(); goto A2828; c722a: $productUrls = $this->productUrlRewriteGenerator->generate($product); goto dd69c; c99e8: c22af: goto A562e; bb258: goto d6362; goto dfe47; Ceaf2: B6bad: goto C54bd; Be2a7: F0cb3: goto c99e8; C54bd: d6362: goto C97f7; A2828: $parentProductIds = $this->catalogProductTypeConfigurable->getParentIdsByChild($productId); goto dee37; dfe47: d8c8a: goto Cc2cf; C3b0e: B7a38: goto bb258; Cb6d5: try { $this->urlQueue->addToQueue($urls); } catch (\Exception $e) { } goto Be2a7; C97f7: if (!count($urls)) { goto F0cb3; } goto Cb6d5; A562e: } }
