<?php
 namespace Mgt\Varnish\Model; use Laminas\Uri\Uri; class UrlQueue extends \Magento\Framework\Model\AbstractModel { const PRIORITY_HIGH = 1000; const PRIORITY_MEDIUM = 500; const PRIORITY_LOW = 100; protected $storeManager; protected $license; protected $licenseCache = []; public function __construct(\Magento\Framework\Model\Context $context, \Magento\Framework\Registry $registry, \Mgt\Varnish\Model\ResourceModel\UrlQueue $resource, \Magento\Store\Model\StoreManagerInterface $storeManager, \Mgt\Varnish\Model\License $license) { goto B7f09; B7f09: parent::__construct($context, $registry, $resource); goto a604a; E53f9: $this->license = $license; goto a23f5; a604a: $this->storeManager = $storeManager; goto E53f9; a23f5: } protected function _construct() { $this->_init("\x4d\x67\164\x5c\126\x61\162\x6e\x69\163\150\x5c\115\x6f\144\145\x6c\x5c\x52\x65\x73\157\165\x72\x63\x65\x4d\x6f\144\x65\x6c\x5c\x55\x72\x6c\x51\x75\x65\165\x65"); } public function getId() { return parent::getData("\165\x72\154\x5f\151\144"); } public function addToQueue(array $urls) { goto Ea55c; B7015: $resource->addToQueue($urls); goto b023c; b0913: if (!$urls) { goto b7f0b; } goto Fd6b9; b023c: b7f0b: goto F2275; Ea55c: $urls = $this->filterUrls($urls); goto b0913; Fd6b9: $resource = $this->_getResource(); goto B7015; F2275: } protected function filterUrls(array $urls) { goto a597a; d3b31: return $filteredUrls; goto a602f; F9454: foreach ($urls as $url) { goto B0c37; B0c37: $storeId = (int) $url["\163\164\157\x72\145\x5f\x69\144"]; goto F1a60; Cfb80: $canAddUrlToQueue = $this->canAddUrlToQueue($storeId); goto B603f; D2d52: $filteredUrls[] = $url; goto Bad85; F1a60: $url["\x70\x61\x74\150"] = ltrim($url["\160\x61\x74\x68"], "\x2f"); goto Cfb80; B603f: if (!(true === $canAddUrlToQueue)) { goto D5aca; } goto D2d52; d8388: d9671: goto ecb4a; Bad85: D5aca: goto d8388; ecb4a: } goto D5306; D5306: d0693: goto d3b31; a597a: $filteredUrls = []; goto F9454; a602f: } protected function canAddUrlToQueue($storeId) { goto a8c77; Dc38e: goto d7b83; goto A09be; C6c18: d7b83: goto A59be; be8bc: return true; goto bc541; B0856: $hasLicense = $this->license->hasLicense($host); goto e28f6; Df0ef: goto a0f5b; goto a0784; e28f6: $this->licenseCache[$storeId] = $hasLicense; goto D9199; dc0c9: return false; goto Df0ef; D9199: if (true === $hasLicense) { goto e406b; } goto dc0c9; E5a92: $uri = new Uri($store->getBaseUrl()); goto D98cd; A09be: aa0f3: goto Ca8c9; bc541: a0f5b: goto Dc38e; a0784: e406b: goto be8bc; a8c77: if (isset($this->licenseCache[$storeId])) { goto aa0f3; } goto bf0bf; bf0bf: $store = $this->storeManager->getStore($storeId); goto E5a92; Ca8c9: $canAddUrlToQueue = $this->licenseCache[$storeId]; goto B7b79; D98cd: $host = $uri->getHost(); goto B0856; B7b79: return $canAddUrlToQueue; goto C6c18; A59be: } }
